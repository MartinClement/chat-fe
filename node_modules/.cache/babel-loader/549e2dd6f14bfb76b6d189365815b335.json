{"ast":null,"code":"import _defineProperty from \"/Users/clement/web/chat-ws/chat/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/Users/clement/web/chat-ws/chat/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/clement/web/chat-ws/chat/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/clement/web/chat-ws/chat/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/clement/web/chat-ws/chat/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/clement/web/chat-ws/chat/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/clement/web/chat-ws/chat/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _taggedTemplateLiteral from \"/Users/clement/web/chat-ws/chat/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/clement/web/chat-ws/chat/src/components/Chat.js\";\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n  background-color: #424242;\\n  color: #fff;\\n  width: 100%;\\n  height: 40px;\\n  box-sizing: border-box;\\n  &:focus {\\n    outline: none;\\n  }\\n\\n  &:-webkit-autofill,\\n  &:-webkit-autofill:hover,\\n  &:-webkit-autofill:focus,\\n  &:-webkit-autofill:active {\\n    transition: all 5000s ease-in-out 0s;\\n  }\\n\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  color: \", \";\\n  font-size: 16px;\\n  font-weight: 600;\\n  margin-right: 10px;\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  color: #fff;\\n  font-size: 16px;\\n  padding: 20px 0 20px 10px;\\n  display: flex;\\n  border-bottom: 1px solid #cfcfcf;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  flex-grow: 1;\\n  padding: 40px 0;\\n  overflow-y: scroll;\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    color: \", \"\\n    font-size: 18px;\\n    margin-left: 5px;\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    color: \", \"\\n    font-weight: 600;\\n    font-size: 18px;\\n    position: absolute;\\n    top: 0px;\\n    left: 0px;\\n    right: 0px;\\n    padding: 10px;\\n    border: 2px solid #fff;\\n    display: flex;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100vw;\\n  height: 100vh;\\n  background: #424242;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  font-size: 16px;\\n  color: #fff;\\n  font-family: Arial, sans-serif;\\n\\n  & > * {\\n    padding: 10px;\\n    border: 3px solid #fff;\\n    border-radius: 3px;\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React from 'react';\nimport styled from 'styled-components';\nvar Wrapper = styled.div(_templateObject());\nvar Status = styled.div(_templateObject2(), function (p) {\n  return p.status === 'disconnected' ? 'red' : p.status === 'connection ...' ? 'orange' : 'green';\n});\nvar Name = styled.div(_templateObject3(), function (p) {\n  return p.color;\n});\nvar Messages = styled.div(_templateObject4());\nvar Msg = styled.div(_templateObject5());\nvar Author = styled.div(_templateObject6(), function (p) {\n  return p.color;\n});\nvar Input = styled.input(_templateObject7());\n\nvar Chat =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Chat, _React$Component);\n\n  function Chat() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Chat);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Chat)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this._connection = null;\n    _this._input = React.createRef();\n    _this.state = {\n      status: '',\n      error: '',\n      chatHistory: [],\n      input: '',\n      name: null,\n      color: ''\n    };\n\n    _this.componentWillMount = function () {\n      var connection = _this.props.connection;\n      _this._connection = connection;\n      _this._connection.onopen = _this.handleConnectionOpen;\n      _this._connection.onerror = _this.handleConnectionError;\n      _this._connection.onmessage = _this.handleConnectionMessage;\n    };\n\n    _this.handleSubmit = function (e) {\n      var v = _this._input.current.value;\n      var name = _this.state.name;\n\n      if (v !== '' && e.keyCode === 13) {\n        _this._connection.send(v);\n\n        _this.setState(function (prev) {\n          return {\n            name: prev.name ? prev.name : v,\n            input: '',\n            status: 'connected'\n          };\n        });\n      }\n    };\n\n    _this.handleConnectionOpen = function () {\n      _this.setState({\n        status: 'connection ...'\n      });\n    };\n\n    _this.handleConnectionError = function (err) {\n      console.log('connection error', err);\n\n      _this.setState({\n        status: 'disconnected',\n        error: 'Connection failed'\n      });\n    };\n\n    _this.handleConnectionMessage = function (msg) {\n      var chatHistory = _this.state.chatHistory;\n\n      try {\n        var json = JSON.parse(msg.data);\n      } catch (e) {\n        console.log('Invalid JSON: ', msg.data);\n        return;\n      }\n\n      if (json.type === 'message') {\n        chatHistory.push(json.data);\n\n        _this.setState({\n          chatHistory: chatHistory\n        });\n      } else {\n        _this.setState(function (prev) {\n          return _objectSpread({}, prev, _defineProperty({}, json.type, json.data));\n        });\n      }\n    };\n\n    _this.handleInputChange = function (e) {\n      _this.setState({\n        input: e.target.value\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(Chat, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      document.addEventListener('keydown', this.handleSubmit);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          name = _this$state.name,\n          chatHistory = _this$state.chatHistory,\n          color = _this$state.color,\n          input = _this$state.input,\n          status = _this$state.status,\n          error = _this$state.error;\n      return React.createElement(Wrapper, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, React.createElement(Messages, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, React.createElement(Status, {\n        status: status,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, status, name && React.createElement(Name, {\n        color: color,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }, \"as : \".concat(name)), error !== '' && \" : \".concat(error)), chatHistory.map(function (m) {\n        return React.createElement(Msg, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169\n          },\n          __self: this\n        }, React.createElement(Author, {\n          color: m.color,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 170\n          },\n          __self: this\n        }, \"\".concat(m.author, \" [\").concat(new Date(m.time).toLocaleTimeString(), \"] : \")), m.text);\n      })), React.createElement(Input, {\n        ref: this._input,\n        type: \"text\",\n        value: input,\n        onChange: function onChange(e) {\n          return _this2.handleInputChange(e);\n        },\n        placeholder: name ? 'Enter your name' : 'Your Message ...',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Chat;\n}(React.Component);\n\nexport default Chat;","map":{"version":3,"sources":["/Users/clement/web/chat-ws/chat/src/components/Chat.js"],"names":["React","styled","Wrapper","div","Status","p","status","Name","color","Messages","Msg","Author","Input","input","Chat","_connection","_input","createRef","state","error","chatHistory","name","componentWillMount","connection","props","onopen","handleConnectionOpen","onerror","handleConnectionError","onmessage","handleConnectionMessage","handleSubmit","e","v","current","value","keyCode","send","setState","prev","err","console","log","msg","json","JSON","parse","data","type","push","handleInputChange","target","document","addEventListener","map","m","author","Date","time","toLocaleTimeString","text","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport styled from 'styled-components'\n\nconst Wrapper = styled.div`\n  width: 100vw;\n  height: 100vh;\n  background: #424242;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  font-size: 16px;\n  color: #fff;\n  font-family: Arial, sans-serif;\n\n  & > * {\n    padding: 10px;\n    border: 3px solid #fff;\n    border-radius: 3px;\n  }\n`\n\nconst Status = styled.div`\n    color: ${p =>\n      p.status === 'disconnected' ? 'red' : p.status === 'connection ...' ? 'orange' : 'green'}\n    font-weight: 600;\n    font-size: 18px;\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    right: 0px;\n    padding: 10px;\n    border: 2px solid #fff;\n    display: flex;\n`\n\nconst Name = styled.div`\n    color: ${p => p.color}\n    font-size: 18px;\n    margin-left: 5px;\n`\n\nconst Messages = styled.div`\n  flex-grow: 1;\n  padding: 40px 0;\n  overflow-y: scroll;\n`\n\nconst Msg = styled.div`\n  color: #fff;\n  font-size: 16px;\n  padding: 20px 0 20px 10px;\n  display: flex;\n  border-bottom: 1px solid #cfcfcf;\n`\n\nconst Author = styled.div`\n  color: ${p => p.color};\n  font-size: 16px;\n  font-weight: 600;\n  margin-right: 10px;\n`\n\nconst Input = styled.input`\n  background-color: #424242;\n  color: #fff;\n  width: 100%;\n  height: 40px;\n  box-sizing: border-box;\n  &:focus {\n    outline: none;\n  }\n\n  &:-webkit-autofill,\n  &:-webkit-autofill:hover,\n  &:-webkit-autofill:focus,\n  &:-webkit-autofill:active {\n    transition: all 5000s ease-in-out 0s;\n  }\n`\nclass Chat extends React.Component {\n  _connection = null\n  _input = React.createRef()\n\n  state = {\n    status: '',\n    error: '',\n    chatHistory: [],\n    input: '',\n    name: null,\n    color: '',\n  }\n\n  componentWillMount = () => {\n    const { connection } = this.props\n    this._connection = connection\n    this._connection.onopen = this.handleConnectionOpen\n    this._connection.onerror = this.handleConnectionError\n    this._connection.onmessage = this.handleConnectionMessage\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleSubmit)\n  }\n\n  handleSubmit = e => {\n    const v = this._input.current.value\n\n    const { name } = this.state\n\n    if (v !== '' && e.keyCode === 13) {\n      this._connection.send(v)\n\n      this.setState(prev => ({\n        name: prev.name ? prev.name : v,\n        input: '',\n        status: 'connected',\n      }))\n    }\n  }\n\n  handleConnectionOpen = () => {\n    this.setState({ status: 'connection ...' })\n  }\n\n  handleConnectionError = err => {\n    console.log('connection error', err)\n    this.setState({\n      status: 'disconnected',\n      error: 'Connection failed',\n    })\n  }\n\n  handleConnectionMessage = msg => {\n    let { chatHistory } = this.state\n\n    try {\n      var json = JSON.parse(msg.data)\n    } catch (e) {\n      console.log('Invalid JSON: ', msg.data)\n      return\n    }\n\n    if (json.type === 'message') {\n      chatHistory.push(json.data)\n      this.setState({ chatHistory })\n    } else {\n      this.setState(prev => ({\n        ...prev,\n        [json.type]: json.data,\n      }))\n    }\n  }\n\n  handleInputChange = e => {\n    this.setState({ input: e.target.value })\n  }\n\n  render() {\n    const { name, chatHistory, color, input, status, error } = this.state\n    return (\n      <Wrapper>\n        <Messages>\n          <Status status={status}>\n            {status}\n            {name && <Name color={color}>{`as : ${name}`}</Name>}\n            {error !== '' && ` : ${error}`}\n          </Status>\n          {chatHistory.map(m => (\n            <Msg>\n              <Author color={m.color}>{`${m.author} [${new Date(\n                m.time,\n              ).toLocaleTimeString()}] : `}</Author>\n              {m.text}\n            </Msg>\n          ))}\n        </Messages>\n        <Input\n          ref={this._input}\n          type=\"text\"\n          value={input}\n          onChange={e => this.handleInputChange(e)}\n          placeholder={name ? 'Enter your name' : 'Your Message ...'}\n        />\n      </Wrapper>\n    )\n  }\n}\n\nexport default Chat\n"]},"metadata":{},"sourceType":"module"}